jobs:
  include:
    - &testpython
      stage: test
      name: "Python 3.6"
      python: 3.6
      install:
        - echo "Req File':' ${REQUIREMENTS:=requirements.txt}"
        - echo "Dev Req File':' ${DEV_REQUIREMENTS:=dev-requirements.txt}"
        - |
          # Install requirements
          if [[ ! -f "${REQUIREMENTS}" ]]; then
              echo "File not found: ${REQUIREMENTS}" 1>&2
              travis_terminate 1
          else
              pip install --upgrade --requirement "${REQUIREMENTS}"
          fi
        - |
          # Install development requirements
          if [[ ! -f "${DEV_REQUIREMENTS}" ]]; then
              echo "File not found: ${DEV_REQUIREMENTS}" 1>&2
              travis_terminate 1
          else
              pip install --upgrade --requirement "${DEV_REQUIREMENTS}"
          fi
      script:
        - |
          if command -v coverage; then
              if [ -f "run_tests.py" ]; then
                  coverage run --concurrency=thread --parallel-mode run_tests.py
              else
                  coverage run --concurrency=thread --parallel-mode -m pytest
              fi
              (coverage combine && coverage report | grep -v -e ' 0%') || true
          else
              if [ -f "run_tests.py" ]; then
                  python run_tests.py
              else
                  python -m pytest
              fi
          fi
    - <<: *testpython
      name: "Python 3.7"
      python: 3.7.3
    - <<: *testpython
      name: "Python 3.8"
      python: 3.8
