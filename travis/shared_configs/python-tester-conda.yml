version: ~> 1.0

python:
  - "3.6"
  - "3.7.3"
  - "3.8"

script:
  - |
    if command -v coverage; then
        if [ -f "run_tests.py" ]; then
            coverage run --concurrency=thread --parallel-mode run_tests.py
        else
            coverage run --concurrency=thread --parallel-mode -m pytest
        fi
        (coverage combine && coverage report | grep -v -e ' 0%') || true
    else
        if [ -f "run_tests.py" ]; then
            python run_tests.py
        else
            python -m pytest
        fi
    fi

import:
  # Order is important here as this is parsed depth-first so it should be
  # the opposite of what makes sense.
  - source: travis/shared_configs/utils-conda-install-config.yml
    mode: deep_merge_prepend
  - source: travis/shared_configs/utils-conda-build.yml
    mode: deep_merge_prepend
  - source: travis/shared_configs/utils-conda-create.yml
    mode: deep_merge_prepend
